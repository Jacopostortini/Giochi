{"remainingRequest":"/home/jacopo/Desktop/unseen.papero.tk/node_modules/babel-loader/lib/index.js!/home/jacopo/Desktop/unseen.papero.tk/node_modules/vue-loader-v16/dist/templateLoader.js??ref--6!/home/jacopo/Desktop/unseen.papero.tk/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/jacopo/Desktop/unseen.papero.tk/node_modules/vue-loader-v16/dist/index.js??ref--0-1!/home/jacopo/Desktop/unseen.papero.tk/src/components/gamePhaseComponents/MapManager.vue?vue&type=template&id=0287285e&scoped=true","dependencies":[{"path":"/home/jacopo/Desktop/unseen.papero.tk/src/components/gamePhaseComponents/MapManager.vue","mtime":1614064448084},{"path":"/home/jacopo/Desktop/unseen.papero.tk/node_modules/cache-loader/dist/cjs.js","mtime":1613718931441},{"path":"/home/jacopo/Desktop/unseen.papero.tk/node_modules/babel-loader/lib/index.js","mtime":1613718931329},{"path":"/home/jacopo/Desktop/unseen.papero.tk/node_modules/vue-loader-v16/dist/templateLoader.js","mtime":1613718935689},{"path":"/home/jacopo/Desktop/unseen.papero.tk/node_modules/cache-loader/dist/cjs.js","mtime":1613718931441},{"path":"/home/jacopo/Desktop/unseen.papero.tk/node_modules/vue-loader-v16/dist/index.js","mtime":1613718935689}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgY3JlYXRlVk5vZGUgYXMgX2NyZWF0ZVZOb2RlLCBvcGVuQmxvY2sgYXMgX29wZW5CbG9jaywgY3JlYXRlQmxvY2sgYXMgX2NyZWF0ZUJsb2NrLCB3aXRoU2NvcGVJZCBhcyBfd2l0aFNjb3BlSWQgfSBmcm9tICJ2dWUiOwoKdmFyIF93aXRoSWQgPSAvKiNfX1BVUkVfXyovX3dpdGhTY29wZUlkKCJkYXRhLXYtMDI4NzI4NWUiKTsKCmV4cG9ydCB2YXIgcmVuZGVyID0gLyojX19QVVJFX18qL193aXRoSWQoZnVuY3Rpb24gKF9jdHgsIF9jYWNoZSwgJHByb3BzLCAkc2V0dXAsICRkYXRhLCAkb3B0aW9ucykgewogIHJldHVybiBfb3BlbkJsb2NrKCksIF9jcmVhdGVCbG9jaygiZGl2IiwgewogICAgY2xhc3M6ICJtYXAtbWFuYWdlcl9fbWFpbi1wYW5lbCIsCiAgICBpZDogIm1hcC1tYW5hZ2VyX19tYWluLXBhbmVsIiwKICAgIG9uTW91c2Vkb3duOiBfY2FjaGVbMV0gfHwgKF9jYWNoZVsxXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuICRzZXR1cC5tb3VzZURvd24gJiYgJHNldHVwLm1vdXNlRG93bi5hcHBseSgkc2V0dXAsIGFyZ3VtZW50cyk7CiAgICB9KSwKICAgIG9uTW91c2Vtb3ZlOiBfY2FjaGVbMl0gfHwgKF9jYWNoZVsyXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuICRzZXR1cC5tb3VzZU1vdmUgJiYgJHNldHVwLm1vdXNlTW92ZS5hcHBseSgkc2V0dXAsIGFyZ3VtZW50cyk7CiAgICB9KSwKICAgIG9uTW91c2V1cDogX2NhY2hlWzNdIHx8IChfY2FjaGVbM10gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiAkc2V0dXAubW91c2VVcCAmJiAkc2V0dXAubW91c2VVcC5hcHBseSgkc2V0dXAsIGFyZ3VtZW50cyk7CiAgICB9KQogIH0sIG51bGwsIDMyCiAgLyogSFlEUkFURV9FVkVOVFMgKi8KICApOwp9KTs="},{"version":3,"sources":["/home/jacopo/Desktop/unseen.papero.tk/src/components/gamePhaseComponents/MapManager.vue"],"names":[],"mappings":";;;;;uBACE,YAAA,CAI8B,KAJ9B,EAI8B;AAJzB,IAAA,KAAK,EAAC,yBAImB;AAHzB,IAAA,EAAE,EAAC,yBAGsB;AAFxB,IAAA,WAAS,EAAA,MAAA,CAAA,CAAA,CAAA,KAAA,MAAA,CAAA,CAAA,CAAA,GAAA;AAAA,aAAE,MAAA,CAAA,SAAA,IAAA,MAAA,CAAA,SAAA,OAAA,MAAA,YAAF;AAAA,KAAA,CAEe;AADxB,IAAA,WAAS,EAAA,MAAA,CAAA,CAAA,CAAA,KAAA,MAAA,CAAA,CAAA,CAAA,GAAA;AAAA,aAAE,MAAA,CAAA,SAAA,IAAA,MAAA,CAAA,SAAA,OAAA,MAAA,YAAF;AAAA,KAAA,CACe;AAAxB,IAAA,SAAO,EAAA,MAAA,CAAA,CAAA,CAAA,KAAA,MAAA,CAAA,CAAA,CAAA,GAAA;AAAA,aAAE,MAAA,CAAA,OAAA,IAAA,MAAA,CAAA,OAAA,OAAA,MAAA,YAAF;AAAA,KAAA;AAAiB,GAJ9B,E,IAAA,E;;AAAA,G","sourcesContent":["<template>\r\n  <div class=\"map-manager__main-panel\"\r\n       id=\"map-manager__main-panel\"\r\n       @mousedown=\"mouseDown\"\r\n       @mousemove=\"mouseMove\"\r\n       @mouseup=\"mouseUp\"></div>\r\n</template>\r\n\r\n<script>\r\nimport *  as PIXI from \"pixi.js\";\r\nimport {\r\n  //getContainerFromPathObject,\r\n  getContainerFromStations,\r\n  keyPressed,\r\n  mapDimension,\r\n  mouseWheelReductionFactor,\r\n  pathsTilesetDimension,\r\n  stationsTilesetDimension,\r\n  tileSize,\r\n  zoomFunctionBase\r\n} from \"../../constants/mapConstants\";\r\nimport stations from \"../../constants/stations\";\r\nimport {onMounted, computed, ref} from \"vue\";\r\nimport pathsTilesetImage from \"../../assets/pathsTileset.png\";\r\nimport stationsTilesetImage from \"../../assets/stationsTileset.png\";\r\nimport paths from \"../../constants/paths\";\r\n//import links from \"../../constants/links\";\r\nexport default {\r\n  name: \"MapManager\",\r\n  setup() {\r\n    const deltaY = ref(0);\r\n    const dragging = ref(false);\r\n    const scale = computed(function (){\r\n      return Math.pow(zoomFunctionBase, deltaY.value/mouseWheelReductionFactor);\r\n    });\r\n\r\n    const app = new PIXI.Application({\r\n      width: tileSize * mapDimension.width,\r\n      height: tileSize * mapDimension.height,\r\n      transparent: true,\r\n      antialias: false\r\n    });\r\n\r\n    PIXI.settings.ROUND_PIXELS = true;\r\n\r\n    app.loader\r\n        .add(\"pathsTileset\", pathsTilesetImage)\r\n        .add(\"stationsTileset\", stationsTilesetImage)\r\n        //.add(\"backgroundTileset\", \"tileset.png\")\r\n        .load((loader, resources) => {\r\n\r\n          //crop tilesets to get tiles textures\r\n\r\n          let pathsTextures = [];\r\n          for (let i = 0; i < pathsTilesetDimension.width * pathsTilesetDimension.height; i++) {\r\n            let x = i % pathsTilesetDimension.width;\r\n            let y = Math.floor(i / pathsTilesetDimension.width);\r\n            pathsTextures[i] = new PIXI.Texture(\r\n                resources.pathsTileset.texture,\r\n                new PIXI.Rectangle(x * tileSize, y * tileSize, tileSize, tileSize)\r\n            );\r\n          }\r\n\r\n          let stationsTextures = [];\r\n          for (let i = 0; i < stationsTilesetDimension.width * stationsTilesetDimension.height; i++) {\r\n            let x = i % stationsTilesetDimension.width;\r\n            let y = Math.floor(i / stationsTilesetDimension.width);\r\n            stationsTextures[i] = new PIXI.Texture(\r\n                resources.stationsTileset.texture,\r\n                new PIXI.Rectangle(x * tileSize, y * tileSize, tileSize, tileSize)\r\n            );\r\n          }\r\n\r\n          /*for (let i = 0; i < links.length; i++){\r\n            app.stage.addChild(getContainerFromPathObject(links[i], stations, tileSize, pathTextures));\r\n          }*/\r\n          let links = new PIXI.Container();\r\n          for (let row = 0; row < mapDimension.height; row++){\r\n            for (let col = 0; col < mapDimension.width; col++){\r\n              let texture = pathsTextures[paths[row][col]];\r\n              let sprite = new PIXI.Sprite(texture);\r\n              sprite.x = tileSize * col;\r\n              sprite.y = tileSize * row;\r\n              links.addChild(sprite);\r\n            }\r\n          }\r\n          app.stage.addChild(links);\r\n          app.stage.addChild(getContainerFromStations(stations, tileSize, stationsTextures));\r\n        });\r\n\r\n\r\n    app.loader.onError.add((e)=>{\r\n      console.error(e);\r\n    });\r\n\r\n    function mouseDown() {\r\n      dragging.value = true;\r\n    }\r\n\r\n    function mouseMove(event) {\r\n      if(dragging.value){\r\n        event.target.parentNode.style.cursor = \"move\";\r\n        event.target.parentNode.scrollLeft -= event.movementX;\r\n        event.target.parentNode.scrollTop -= event.movementY;\r\n      }\r\n    }\r\n\r\n    function mouseUp(event) {\r\n      dragging.value = false;\r\n      event.target.parentNode.style.cursor = \"auto\";\r\n    }\r\n\r\n    function zoom(event) {\r\n      let zoomFactor = 1;\r\n      if(deltaY.value+event.deltaY<0){\r\n        deltaY.value = 0;\r\n      } else {\r\n        deltaY.value += event.deltaY;\r\n        zoomFactor = Math.pow(zoomFunctionBase, event.deltaY/mouseWheelReductionFactor);\r\n      }\r\n      let panel = document.querySelector(\".map-manager__main-panel\");\r\n      let sL = event.offsetX*(zoomFactor-1)+panel.scrollLeft*zoomFactor;\r\n      let sT = event.offsetY*(zoomFactor-1)+panel.scrollTop*zoomFactor;\r\n      panel.scrollLeft = Math.round(sL);\r\n      panel.scrollTop = Math.round(sT);\r\n    }\r\n\r\n    onMounted(() => {\r\n      document.getElementById(\"map-manager__main-panel\").appendChild(app.view);\r\n      window.addEventListener(\"keydown\", keyPressed);\r\n    });\r\n\r\n    return{\r\n      scale,\r\n      mouseDown,\r\n      mouseMove,\r\n      mouseUp,\r\n      zoom\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\r\n.map-manager__main-panel{\r\n  overflow: hidden;\r\n  width: 100%;\r\n  height: 100%;\r\n  border-radius: 0 20px 20px 0;\r\n}\r\n</style>"],"sourceRoot":""}]}